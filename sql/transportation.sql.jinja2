SELECT
    ST_AsMVTGeom((ST_Dump(ST_LineMerge(ST_Collect(way)))).geom, {{bbox}}, {{extent}}) AS way,
    highway
  FROM planet_osm_roads
  WHERE way && {{bbox}}
{% if zoom <= 6 %}
    AND highway IN ('motorway', 'trunk')
{% elif zoom <= 8 %}
    AND highway IN ('motorway', 'trunk', 'primary')
{% else %}
    AND highway IN ('motorway', 'trunk', 'primary', 'secondary')
{% endif %}
  GROUP BY highway
